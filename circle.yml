machine:
  java:
    version: oraclejdk8

dependencies:
  override:
    - mvn dependency:resolve

test:
  override:
    - mvn clean install -Dspring.datasource.url=jdbc:postgresql://127.0.0.1:5432/circle_test -Dspring.datasource.username=ubuntu -Dspring.datasource.password=password
  post:
    - mkdir -p $CIRCLE_TEST_REPORTS/junit/
    - find . -type f -regex ".*/target/surefire-reports/.*xml" -exec cp {} $CIRCLE_TEST_REPORTS/junit/ \;
    - bash <(curl -s https://codecov.io/bash)

deployment:
  staging:
    branch: master
    commands:
      - git push git@heroku.com:url-check-database-sample.git $CIRCLE_SHA1:refs/heads/master
      - git push git@heroku.com:url-check-database-sample-2.git $CIRCLE_SHA1:refs/heads/master

